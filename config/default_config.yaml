# ============================================================================
# HybridRAG v3 -- Master Configuration
# ============================================================================
#
# This file controls every tunable setting in HybridRAG.
# Each key MUST match the Python dataclass field name in config.py exactly.
# If a key doesn't match, it will be silently ignored and you'll see a
# [WARN] at startup (safety net added 2026-02-14).
#
# Priority: Environment variables > This YAML file > Hardcoded defaults
#
# UPDATED: 2026-02-14 -- Fixed 13 mismatched keys found by diagnostic suite.
# ============================================================================


# --- Operating Mode ---
# "offline" = Ollama (local, free, no internet)
# "online"  = API (OpenRouter/Azure, costs money, needs internet)
mode: offline


# --- Paths ---
# NOTE: These are usually overridden by environment variables set in
# start_hybridrag.ps1 (HYBRIDRAG_DATA_DIR, HYBRIDRAG_INDEX_FOLDER).
# Only set these if you are NOT using the startup script.
paths:
  database: ""           # Full path to hybridrag.sqlite3
  embeddings_cache: ""   # Folder where memmap files live
  source_folder: ""      # Folder containing documents to index


# --- Embedding Model ---
embedding:
  model_name: all-MiniLM-L6-v2    # Was "model" -- must be "model_name"
  dimension: 384                    # Must match model output
  batch_size: 16                    # Chunks embedded at once
  device: cpu                       # "cpu" or "cuda" (GPU)


# --- Text Chunking ---
chunking:
  chunk_size: 1200       # Characters per chunk
  overlap: 200           # Character overlap between chunks
  max_heading_len: 160   # Max heading prefix on chunks


# --- Ollama (Offline LLM) ---
ollama:
  base_url: http://localhost:11434   # Was "host" -- must be "base_url"
  model: llama3
  timeout_seconds: 600               # Was "timeout" -- must be "timeout_seconds"
  context_window: 8192               # Max tokens the model can see


# --- API (Online LLM) ---
# Removed ghost keys that had no Python field:
#   api_version, auth_scheme, deployment, key, provider
# Those were being silently ignored. Credentials are stored
# securely via rag-store-key and rag-store-endpoint instead.
api:
  endpoint: https://openrouter.ai/api/v1
  model: gpt-3.5-turbo
  max_tokens: 2048
  temperature: 0.1
  timeout_seconds: 30


# --- Cost Tracking (Online Mode Only) ---
cost:
  track_enabled: true
  input_cost_per_1k: 0.0015
  output_cost_per_1k: 0.002
  daily_budget_usd: 5.0


# --- Retrieval / Search ---
retrieval:
  top_k: 5                    # Chunks sent to LLM
  min_score: 0.3              # Minimum similarity (0-1)
  hybrid_search: true          # Was "hybrid" -- must be "hybrid_search"
  rrf_k: 60                   # Reciprocal Rank Fusion constant
  reranker_enabled: false      # Was "reranker" -- must be "reranker_enabled"
  reranker_model: cross-encoder/ms-marco-MiniLM-L-6-v2
  reranker_top_n: 20          # Candidates before reranking
  min_chunks: 1               # Min chunks before calling LLM


# --- Indexing ---
indexing:
  max_chars_per_file: 2000000
  block_chars: 200000


# --- Security ---
# Removed "offline_mode" -- not a valid field.
# Network lockdown is handled by start_hybridrag.ps1 env vars.
security:
  audit_logging: true
  pii_sanitization: true
